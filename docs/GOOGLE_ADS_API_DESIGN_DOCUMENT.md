# Google Ads API - 設計ドキュメント
**株式会社Awake**

---

## 1. プロジェクト概要

### 1.1 会社情報
- **会社名**: 株式会社Awake
- **所在地**: 東京都東大和市向原5-1129-61 渡辺ビル1F
- **法人番号**: 8012801020829
- **設立**: 2023年10月
- **事業内容**:
  - ホームページ制作
  - AIチャットボット開発
  - Amazon販売代行
- **ウェブサイト**: https://www.awakeinc.co.jp/

### 1.2 プロジェクト目的
株式会社Awakeは、自社サービスの集客強化を目的として、Google広告を運用しています。

現在、広告運用におけるキーワード管理、入札調整、パフォーマンス分析などの作業を手動で行っており、以下の課題が発生しています：

**課題**:
- キーワードの追加・更新に時間がかかる（手動入力）
- 入札価格の最適化が遅れる
- レポート作成に多くの時間を費やす
- データ分析の効率が悪い

**解決策**:
Google Ads APIを活用し、広告運用業務を自動化することで、これらの課題を解決します。

---

## 2. ツールの概要

### 2.1 ツール名
**Awake Ads Automation System**

### 2.2 開発言語・環境
- **言語**: JavaScript (Node.js v18+)
- **ライブラリ**: google-ads-api (公式Node.jsライブラリ)
- **実行環境**: 社内サーバー
- **アクセス権**: 社内従業員のみ（外部クライアント向けサービスなし）

### 2.3 主な機能

#### 機能1: キーワード自動管理
- キーワードの一括追加
- キーワードの除外リスト管理
- マッチタイプの自動設定（完全一致、フレーズ一致、部分一致）

#### 機能2: 入札管理
- キーワードごとの入札価格設定
- パフォーマンスに基づく入札調整（将来実装予定）

#### 機能3: レポート取得
- キャンペーンパフォーマンスレポート
- キーワードパフォーマンスレポート
- 日次・週次・月次レポートの自動生成

---

## 3. システムアーキテクチャ

### 3.1 全体構成図

```
┌─────────────────────────────────────────────────────────┐
│                    株式会社Awake                         │
│                   社内システム                            │
└─────────────────────────────────────────────────────────┘
                          │
                          │ OAuth 2.0
                          │ (Refresh Token)
                          ▼
┌─────────────────────────────────────────────────────────┐
│                Google Ads API                            │
│              (Google Cloud Platform)                     │
└─────────────────────────────────────────────────────────┘
                          │
                          ▼
┌─────────────────────────────────────────────────────────┐
│              Google広告アカウント                         │
│        顧客ID: 404-045-1201                              │
│        MCC ID: 321-411-2286                              │
└─────────────────────────────────────────────────────────┘
```

### 3.2 認証フロー

```
1. [社内システム] OAuth 2.0認証リクエスト
                     ↓
2. [Google] 認証画面表示 → ユーザー承認
                     ↓
3. [Google] Refresh Tokenを発行
                     ↓
4. [社内システム] Refresh Tokenを安全に保存
                     ↓
5. [社内システム] API呼び出し時にAccess Tokenを自動取得
```

---

## 4. データフロー

### 4.1 キーワード追加フロー

```
┌──────────────┐
│ キーワード    │
│ CSVファイル   │  ← 社内で作成
└──────────────┘
       │
       ▼
┌──────────────┐
│ Node.js      │
│ スクリプト    │  ← キーワードを読み込み
└──────────────┘
       │
       ▼ Google Ads API
┌──────────────┐
│ KeywordPlan  │
│ Service      │  ← キーワード検証
└──────────────┘
       │
       ▼
┌──────────────┐
│ AdGroup      │
│ Criterion    │  ← キーワード追加
│ Service      │
└──────────────┘
       │
       ▼
┌──────────────┐
│ Google広告    │  ← キーワードが反映
│ アカウント    │
└──────────────┘
```

### 4.2 レポート取得フロー

```
┌──────────────┐
│ Node.js      │
│ スクリプト    │  ← 定期実行（cron）
└──────────────┘
       │
       ▼ Google Ads API
┌──────────────┐
│ GoogleAds    │
│ Service      │  ← GAQL クエリ実行
└──────────────┘
       │
       ▼
┌──────────────┐
│ レポート      │  ← JSON/CSV形式
│ データ        │
└──────────────┘
       │
       ▼
┌──────────────┐
│ 社内          │  ← データ分析
│ ダッシュボード │
└──────────────┘
```

---

## 5. 使用するAPI機能

### 5.1 主要API

#### GoogleAdsService
- **用途**: GAQL（Google Ads Query Language）を使用したデータ取得
- **使用例**:
  - キャンペーン一覧取得
  - 広告グループ一覧取得
  - パフォーマンスデータ取得

#### CampaignService
- **用途**: キャンペーン情報の取得・更新
- **使用例**:
  - キャンペーン設定確認
  - 予算情報取得

#### AdGroupService
- **用途**: 広告グループ情報の取得・更新
- **使用例**:
  - 広告グループ一覧取得
  - 入札価格設定

#### AdGroupCriterionService
- **用途**: キーワード管理
- **使用例**:
  - キーワード追加
  - キーワード削除
  - 入札価格設定

#### KeywordPlanService
- **用途**: キーワードプランニング
- **使用例**:
  - キーワード検索ボリューム取得
  - キーワード競合度確認

### 5.2 使用しないAPI

以下のAPIは使用しません：

- **Display Ads API**: ディスプレイ広告は使用しない
- **Video Ads API**: 動画広告は使用しない
- **Shopping Ads API**: ショッピング広告は使用しない
- **App Conversion Tracking**: アプリコンバージョン計測は使用しない

---

## 6. セキュリティ対策

### 6.1 認証情報の保護

```javascript
// ❌ 悪い例: ハードコード
const client_secret = "GOCSPX-xxxxx";

// ✅ 良い例: 環境変数または設定ファイル
const config = require('./google-ads-config.json');
```

**対策**:
- OAuth認証情報は設定ファイルに保存
- 設定ファイルは `.gitignore` で除外（Gitにコミットしない）
- ファイルパーミッションを制限（読み取り権限を最小化）

### 6.2 アクセス制御

- **内部利用のみ**: 社内従業員のみがスクリプトを実行可能
- **外部公開なし**: APIキーやトークンを外部に公開しない
- **ログ管理**: API呼び出しログを記録し、不正アクセスを検知

### 6.3 データ保護

- **個人情報**: 取得しない（広告パフォーマンスデータのみ）
- **データ保存**: 取得したレポートは社内サーバーに保存
- **暗号化**: 必要に応じてデータを暗号化

---

## 7. APIリクエスト設計

### 7.1 キーワード追加リクエスト例

```javascript
const operation = {
  create: {
    adGroup: `customers/${customerId}/adGroups/${adGroupId}`,
    status: 'ENABLED',
    keyword: {
      text: 'ホームページ制作 東大和市',
      matchType: 'PHRASE'
    },
    cpcBidMicros: 150000000  // 150円
  }
};
```

### 7.2 GAQLクエリ例

```sql
SELECT
  campaign.id,
  campaign.name,
  ad_group.id,
  ad_group.name,
  metrics.impressions,
  metrics.clicks,
  metrics.ctr,
  metrics.cost_micros
FROM ad_group
WHERE segments.date DURING LAST_30_DAYS
ORDER BY metrics.impressions DESC
```

### 7.3 APIレート制限への対応

- **バッチ処理**: 複数のキーワードを1回のリクエストで追加
- **リトライ処理**: エラー時に自動リトライ（最大3回）
- **レート制限監視**: 1日あたりのAPI呼び出し数を監視

```javascript
// リトライ処理の実装例
async function retryOperation(operation, maxRetries = 3) {
  for (let i = 0; i < maxRetries; i++) {
    try {
      return await operation();
    } catch (error) {
      if (i === maxRetries - 1) throw error;
      await sleep(1000 * (i + 1)); // 1秒、2秒、3秒待機
    }
  }
}
```

---

## 8. 使用シナリオ

### 8.1 シナリオ1: 新規キャンペーンの立ち上げ

**目的**: 新サービス「AIチャットボット開発」の広告キャンペーンを開始

**手順**:
1. Google広告管理画面でキャンペーンと広告グループを作成
2. キーワードリストをCSVで準備（59個のキーワード）
3. スクリプトを実行してキーワードを一括追加
   ```bash
   node scripts/google-ads-add-keywords.js
   ```
4. 広告配信開始

**効果**:
- 手動入力: 約2時間 → 自動化: 約5分（**96%削減**）

### 8.2 シナリオ2: 週次パフォーマンスレポート

**目的**: 毎週月曜日に先週のパフォーマンスを確認

**手順**:
1. cronジョブでスクリプトを自動実行（毎週月曜 9:00）
   ```
   0 9 * * 1 node scripts/google-ads-weekly-report.js
   ```
2. レポートをCSV形式で出力
3. メールで担当者に送信

**取得データ**:
- クリック数
- 表示回数
- CTR（クリック率）
- CPC（クリック単価）
- コンバージョン数
- ROAS（広告費用対効果）

### 8.3 シナリオ3: 入札価格の最適化

**目的**: パフォーマンスが良いキーワードの入札を強化

**手順**:
1. パフォーマンスレポートを取得
2. CVRが高いキーワード（10%以上）を特定
3. 入札価格を20%増額
4. CTRが低いキーワード（1%未満）の入札を削減

**効果**:
- ROI改善: 約15-20%向上（予測）

---

## 9. 期待される効果

### 9.1 業務効率化

| 作業項目 | 手動 | 自動化 | 削減率 |
|---------|------|--------|--------|
| キーワード追加（59個） | 2時間 | 5分 | 96% |
| 週次レポート作成 | 1時間 | 自動 | 100% |
| 入札価格調整 | 30分 | 5分 | 83% |
| **合計（週）** | **4.5時間** | **0.5時間** | **89%** |

### 9.2 広告パフォーマンス向上

- **CTR向上**: 適切なキーワード管理により3-5%改善
- **CPC削減**: 入札最適化により10-15%削減
- **ROAS向上**: データドリブンな運用により20%改善

### 9.3 コスト削減

- **人件費削減**: 月16時間の作業時間削減
- **広告費最適化**: 無駄なクリックを削減

---

## 10. 運用ルール

### 10.1 API使用ガイドライン

- ✅ **許可される使用**:
  - 自社アカウント（404-045-1201）の管理
  - キーワード管理、入札管理、レポート取得
  - 業務効率化を目的とした自動化

- ❌ **禁止される使用**:
  - 外部クライアントの広告アカウント管理
  - APIキーの第三者への共有
  - Google広告ポリシーに違反する広告の作成

### 10.2 モニタリング

- **API呼び出し数**: 日次で監視
- **エラーログ**: 週次で確認
- **パフォーマンス**: 月次でレビュー

### 10.3 アップデート計画

- **Phase 1**（現在）: キーワード管理の自動化
- **Phase 2**（3ヶ月後）: 入札最適化の自動化
- **Phase 3**（6ヶ月後）: 機械学習による予測モデル導入

---

## 11. サポート・連絡先

### 11.1 社内担当者

- **プロジェクト責任者**: 田形康貴
- **連絡先**: ai.ec@awakeinc.co.jp
- **電話**: 050-7115-4948

### 11.2 APIサポート

- **API連絡先メールアドレス**: ai.ec@awakeinc.co.jp
- **MCCアカウントID**: 321-411-2286
- **顧客アカウントID**: 404-045-1201

---

## 12. 付録

### 12.1 使用ライブラリ

```json
{
  "dependencies": {
    "google-ads-api": "^16.0.0"
  }
}
```

### 12.2 環境要件

- **Node.js**: v18.0.0以上
- **OS**: Windows 10/11, macOS, Linux
- **ネットワーク**: インターネット接続必須

### 12.3 参考資料

- Google Ads API 公式ドキュメント: https://developers.google.com/google-ads/api/docs/start
- Google Ads API Node.jsライブラリ: https://github.com/Opteo/google-ads-api
- OAuth 2.0認証ガイド: https://developers.google.com/identity/protocols/oauth2

---

**作成日**: 2025年10月23日
**バージョン**: 1.0
**作成者**: 株式会社Awake 田形康貴
**承認者**: 株式会社Awake 代表取締役
